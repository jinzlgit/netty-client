package com.jyd.netty.decoder;

import io.netty.buffer.ByteBuf;
import io.netty.buffer.Unpooled;
import io.netty.channel.ChannelInitializer;
import io.netty.channel.embedded.EmbeddedChannel;
import io.netty.handler.codec.LengthFieldBasedFrameDecoder;
import io.netty.handler.codec.string.StringDecoder;
import io.netty.util.CharsetUtil;
import org.junit.Test;

public class TestDecoderTest {

    @Test
    public void decode() {
        EmbeddedChannel channel = new EmbeddedChannel(new ChannelInitializer<EmbeddedChannel>() {
            @Override
            protected void initChannel(EmbeddedChannel ec) throws Exception {
                ec.pipeline()
                        .addLast("内置自定义长度解码器", new LengthFieldBasedFrameDecoder(1024, 3,
                                2, 0, 5))
                        .addLast("内置字符串解码器", new StringDecoder(CharsetUtil.UTF_8))
                        .addLast("自定义解码器", new ByteToHexStringDecoder());
            }
        });

        ByteBuf buffer = Unpooled.buffer();
        String s = "1A1A1A032DA2CAD27B430015058B058C05970594059E05A105A705AF05AD05B005B905BC05C205C605C705C805D405D705E005DF05E905E905F205F605F605FE0607060A06060612061B061D061E062206260631062F063906430645064E0652065806610664066E066B0679067B0685068506960696069F06A906AC06B106C506C506CD06D206E006E506F106F306FB070C070C071A071D072B0736073A074407510756075F076A077B077E0790079107A307A407B307B907CD07D607DF07EC07F707FD080E081B0826083408430848085C08660872087B0893089E08B208B408CF08DB08ED08EF09080917092909320949095B0971097F099E09AE09BD09C909EB09F80A140A200A430A510A6C0A780A9D0AB90AD50AE00B0D0B220B3D0B5A0B870B930BB40BCE0BF50C0A0C330C4B0C830C9B0CBE0CDE0D130D2C0D5F0D760DC90DE90E1F0E500E910EB70EF00F000F2A0F2B0F220F440F410F3D0F360F310F2A0F2C0F210F140F1D0F100F0D0F090F020EFF0EFC0EF60EF40EE90EED0EDE0EDB0EE00EDC0ED40ED40ECC0ECB0EC90EBA0EBF0EBF0EB70EB90EB10EB00EB30EAA0EA20EA20EA10EA10E9F0EA40E980E990E9A0E990E9A0E940E910E910E8F0E900E8E0E890E830E890E880E8A0E870E850E880E850E850E8D0E850E870E820E830E880E8A0E840E790E860E830E850E840E8B0E860E800E920E910E900E8E0E8E0E8C0E8E0E8F0E960E9C0E9D0E9F0EA10E970EA10EA40EAB0EA70EA90EB80EA50EB70EB70EBB0EC00EC60EC60ECB0EC00EC50ED30ED30ED30EDF0EDF0EE90EEA0EEC0EF30EF60EF70EFD0F0E0F0A0F100F140F180F1D0F230F290F310F290F3A0F430F440F490F630F630F690F6C0F7B0F780F860F890F920FA10F950FB30FB00FB00FC10FCA0FD30FDC0FDF0FE50FF30FF30FF31008101D102310280E660D7A0CB80CA50CA80DAC0D9E0DAC0DAC0DC20DC50DCE0DC80DE60DE00DEC0DF90E1B0E050E220E180E310E260E240E300E4E0E3F0E480E560E640E520E600E5E0E6D0E670E6B0E600E450E450E240E2B0E190E0A0DEF0DD90DC30DB40D9A0AEF0AB70AB00A950A8A0A760A6E0A610A530A4A0A3B0A270A1D09ED09E409F309DC09CD09D209C909D409E309E47E";
        char[] chars = s.toCharArray();
        for (char c : chars) {
            buffer.writeChar(c);
        }
        channel.writeInbound(buffer);
        try {
            Thread.sleep(Integer.MAX_VALUE);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
    }

    public static void main(String[] args) {
        String s = "1A1A1A032DA2CAD27B430015058B058C05970594059E05A105A705AF05AD05B005B905BC05C205C605C705C805D405D705E005DF05E905E905F205F605F605FE0607060A06060612061B061D061E062206260631062F063906430645064E0652065806610664066E066B0679067B0685068506960696069F06A906AC06B106C506C506CD06D206E006E506F106F306FB070C070C071A071D072B0736073A074407510756075F076A077B077E0790079107A307A407B307B907CD07D607DF07EC07F707FD080E081B0826083408430848085C08660872087B0893089E08B208B408CF08DB08ED08EF09080917092909320949095B0971097F099E09AE09BD09C909EB09F80A140A200A430A510A6C0A780A9D0AB90AD50AE00B0D0B220B3D0B5A0B870B930BB40BCE0BF50C0A0C330C4B0C830C9B0CBE0CDE0D130D2C0D5F0D760DC90DE90E1F0E500E910EB70EF00F000F2A0F2B0F220F440F410F3D0F360F310F2A0F2C0F210F140F1D0F100F0D0F090F020EFF0EFC0EF60EF40EE90EED0EDE0EDB0EE00EDC0ED40ED40ECC0ECB0EC90EBA0EBF0EBF0EB70EB90EB10EB00EB30EAA0EA20EA20EA10EA10E9F0EA40E980E990E9A0E990E9A0E940E910E910E8F0E900E8E0E890E830E890E880E8A0E870E850E880E850E850E8D0E850E870E820E830E880E8A0E840E790E860E830E850E840E8B0E860E800E920E910E900E8E0E8E0E8C0E8E0E8F0E960E9C0E9D0E9F0EA10E970EA10EA40EAB0EA70EA90EB80EA50EB70EB70EBB0EC00EC60EC60ECB0EC00EC50ED30ED30ED30EDF0EDF0EE90EEA0EEC0EF30EF60EF70EFD0F0E0F0A0F100F140F180F1D0F230F290F310F290F3A0F430F440F490F630F630F690F6C0F7B0F780F860F890F920FA10F950FB30FB00FB00FC10FCA0FD30FDC0FDF0FE50FF30FF30FF31008101D102310280E660D7A0CB80CA50CA80DAC0D9E0DAC0DAC0DC20DC50DCE0DC80DE60DE00DEC0DF90E1B0E050E220E180E310E260E240E300E4E0E3F0E480E560E640E520E600E5E0E6D0E670E6B0E600E450E450E240E2B0E190E0A0DEF0DD90DC30DB40D9A0AEF0AB70AB00A950A8A0A760A6E0A610A530A4A0A3B0A270A1D09ED09E409F309DC09CD09D209C909D409E309E47E";
        byte[] bytes = s.getBytes();
        for (byte b : bytes) {
            System.out.print(b);
        }
    }
}